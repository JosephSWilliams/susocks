#!/bin/sh
if [ -z $3 ]; then
  echo $0' <user> <addr> <port>'
  exit 1
fi

mkdir -p /services || exit 1
mkdir -p /services/susocks5-$2-$3 || exit 1
mkdir -p /services/susocks5-$2-$3/conf || exit 1
echo '#!/bin/sh -e' > /services/susocks5-$2-$3/run || exit 1
echo 'setuidgid '$1' tcpserver '$2' '$3' /services/susocks/susocks5' >> /services/susocks5-$2-$3/run || exit 1
cp src/ALLOW.default /services/susocks5-$2-$3/conf/ALLOW   || exit 1
cp src/REJECT.default /services/susocks5-$2-$3/conf/REJECT || exit 1
chmod +x /services/susocks5-$2-$3/run
test -L /service/susocks5-$2-$3 || ln -s /services/susocks5-$2-$3 /service/susocks5-$2-$3 || exit 1
